<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>firstapp</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body class="bg-light">
    <noscript>
      <strong>We're sorry but firstapp doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <main role="main" class="container">
        <div class="row">
            <div class="col-lg-12">

                <form id='moduloCompareWebiste'>
                    <div class="form-group">
                        <label for="domain1">Url 1 </label>
                        <input type="domain1" class="form-control" id="domain1" value="https://www.gazzetta.it">
                    </div>
                    <div class="form-group">
                        <label for="domain2">Url 2</label>
                        <input type="domain2" class="form-control" id="domain2" value="https://www.tuttosport.it">
                    </div>
                    <br/>
                    <button type="button" id="findAndCompare">findAndCompare</button>
                </form>

            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <br/>
                <div id="countInputChar">Number of characters (url1+url2): <span></span></div>
                <div id="alphabetNumberInput">Positions in the alphabet (url1): <span></span></div>
                <div id="nowtime"><span></span></div>

            </div>
        </div>
    </main>
    <!-- built files will be auto injected -->
</body>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script>
    $('document').ready(function() {

        function validateDomain(strUrl) {

            if (check_url(strUrl) == false)
                return false;

            url = new URL(strUrl);

            protocol = url.protocol;
            hostname = url.hostname;
            port = url.port;

            if (protocol != 'https:' && protocol != 'http:')
                return false;

            valido = protocol + '//' + hostname;
            if (port != '')
                valido += ':' + port;

            if (valido == strUrl || valido + '/' == strUrl)
                return true;
            else
                return false;

        }

        function check_url(str) {

            var pattern = new RegExp('^(https?:\\/\\/)?' + // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
                '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator 

            return !!pattern.test(str);

        }


        function countCharInput() {
            countchar = $('#domain1').val().length + $('#domain2').val().length
            $('#countInputChar span').text(countchar);

        }

        function alphabetNumberInput() {

            let input = $('#domain1').val().trim().toLowerCase();
            let sumInput = 0;

            for (i in input) {
                let letter = input[i];
                if (typeof alphabetIndex[input[i]] != "undefined") {
                    sumInput += parseInt(alphabetIndex[input[i]]) + 1;
                    //console.log('lettera ' + input[i] + ': posizione ' + i + ' numer ' + alphabetIndex[input[i]]);
                }

            }
            $('#alphabetNumberInput span').text(sumInput);

        }

        function downloadFileCsv2(urlPage) {

            // Create an invisible A element
            const a = document.createElement("a");
            a.style.display = "none";
            document.body.appendChild(a);

            // Set the HREF to a Blob representation of the data to be downloaded
            a.href = urlPage;
            a.setAttribute("target", "_blank");
            // Trigger the download by simulating click

            /*a.addEventListener("click", function(event) {
                event.preventDefault()
                
            });*/
            a.click();
            // Cleanup
            window.URL.revokeObjectURL(a.href);
            document.body.removeChild(a);

        }

        function downloadFileCsv(urlPage) {

            var url = urlPage;
            wd = window.open(url, 'Download');
            // wd.close();

        }

        function initApp() {

            let alphabet = "abcdefghijklmnopqrstuvwxyz";
            for (i in alphabet) {
                let letter = alphabet[i];
                alphabetIndex[letter] = i;
                //console.log('lettera ' + alphabet[i] + ': posizione ' + i);
            }
            countCharInput();
            alphabetNumberInput();


            let currentdate = new Date();
            let nowtime = "Last Sync: " + currentdate.getDay() + "/" + currentdate.getMonth() +
                "/" + currentdate.getFullYear() + " @ " +
                currentdate.getHours() + ":" +
                currentdate.getMinutes() + ":" + currentdate.getSeconds();

            $('#nowtime span').text(nowtime);
        }
        var alphabetIndex = [];
        var Config = [];
        Config['endpointUrlCrawl'] = 'http://127.0.0.1/siti-applicazioni/project-instilla/backend/compare-domains.php';

        initApp();

        $('#moduloCompareWebiste').on('keyup', 'input', function(ele) {
            $('#domain1').val($('#domain1').val().trim());
            $('#domain2').val($('#domain2').val().trim());
            countCharInput();
            alphabetNumberInput();

        });
        $('#moduloCompareWebiste').on('click', 'button', function(ele) {

            ele.preventDefault();
            domain1 = $('#domain1').val().trim();
            domain2 = $('#domain2').val().trim();
            /*if (domain1 == domain2) {
                alert('inserire domini diversi');
                return false;
            }*/
            if (validateDomain(domain1) == false || validateDomain(domain2) == false) {
                alert("verificare i valori immessi");
                return false;
            }

            endpointUrlCrawl = Config['endpointUrlCrawl'];

            endpointUrlCrawl += '?domain1=' + domain1 + '&domain2=' + domain2;
            downloadFileCsv(endpointUrlCrawl);
            return false;
            $.ajax(
                endpointUrlCrawl, {
                    method: 'GET',
                    data: {
                        'domain1': encodeURIComponent(domain1),
                        'domain2': encodeURIComponent(domain2)
                    },
                    complete: function(resp) {
                        alert(resp.responseText);

                    }
                }
            );

        });


    });
</script>

</html>